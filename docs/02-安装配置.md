# 02. å®‰è£…é…ç½®

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•å®‰è£…å’Œé…ç½® DiT æ–‡ç”Ÿå›¾é¡¹ç›®çš„å¼€å‘ç¯å¢ƒã€‚

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

- **GPU**: NVIDIA GPUï¼ˆæ¨è RTX 4090 æˆ–æ›´é«˜ï¼‰
  - æ˜¾å­˜: è‡³å°‘ 24GBï¼ˆRTX 4090ï¼‰
  - CUDA è®¡ç®—èƒ½åŠ›: 7.5 æˆ–æ›´é«˜
- **å†…å­˜**: è‡³å°‘ 16GB RAM
- **å­˜å‚¨**: è‡³å°‘ 50GB å¯ç”¨ç©ºé—´ï¼ˆç”¨äºæ¨¡å‹ã€æ•°æ®å’Œæ£€æŸ¥ç‚¹ï¼‰

### è½¯ä»¶è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linuxï¼ˆæ¨èï¼‰æˆ– Windowsï¼ˆWSL2ï¼‰
- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæ¨è 3.10ï¼‰
- **CUDA**: 11.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **cuDNN**: 8.0 æˆ–æ›´é«˜ç‰ˆæœ¬

## ğŸ”§ å®‰è£…æ­¥éª¤

### 1. å®‰è£… CUDA å’Œ cuDNN

#### Linux

```bash
# æ£€æŸ¥ CUDA ç‰ˆæœ¬
nvidia-smi

# å¦‚æœæœªå®‰è£…ï¼Œå‚è€ƒ NVIDIA å®˜æ–¹æ–‡æ¡£å®‰è£… CUDA Toolkit
# https://developer.nvidia.com/cuda-downloads
```

#### Windows

ä¸‹è½½å¹¶å®‰è£… CUDA Toolkitï¼š
- https://developer.nvidia.com/cuda-downloads

### 2. åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ

**ä½¿ç”¨ Condaï¼ˆæ¨èï¼‰**ï¼š

```bash
# åˆ›å»ºç¯å¢ƒ
conda create -n dit python=3.10
conda activate dit

# å®‰è£… PyTorchï¼ˆæ ¹æ® CUDA ç‰ˆæœ¬é€‰æ‹©ï¼‰
# CUDA 11.8
conda install pytorch torchvision torchaudio pytorch-cuda=11.8 -c pytorch -c nvidia

# CUDA 12.1
conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia
```

**ä½¿ç”¨ venv**ï¼š

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows
```

### 3. å®‰è£…é¡¹ç›®ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/t2i2

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 4. éªŒè¯å®‰è£…

è¿è¡ŒéªŒè¯è„šæœ¬ï¼š

```bash
python verify_setup.py
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… PyTorch ç‰ˆæœ¬: 2.x.x
âœ… CUDA å¯ç”¨: True
âœ… CUDA ç‰ˆæœ¬: 11.8
âœ… GPU è®¾å¤‡: NVIDIA GeForce RTX 4090
âœ… ä¾èµ–åŒ…æ£€æŸ¥é€šè¿‡
```

## ğŸ“¦ ä¾èµ–åŒ…è¯´æ˜

### æ ¸å¿ƒä¾èµ–

- **torch>=2.0.0** - PyTorch æ·±åº¦å­¦ä¹ æ¡†æ¶
- **torchvision>=0.15.0** - å›¾åƒå¤„ç†å·¥å…·

### Hugging Face åº“

- **diffusers>=0.21.0** - æ‰©æ•£æ¨¡å‹åº“
- **transformers>=4.30.0** - Transformer æ¨¡å‹åº“
- **accelerate>=0.20.0** - è®­ç»ƒåŠ é€Ÿåº“
- **datasets>=2.12.0** - æ•°æ®é›†ç®¡ç†åº“
- **huggingface-hub>=0.16.0** - Hugging Face Hub å®¢æˆ·ç«¯

### å›¾åƒå¤„ç†

- **pillow>=9.5.0** - å›¾åƒå¤„ç†åº“
- **opencv-python>=4.7.0** - è®¡ç®—æœºè§†è§‰åº“

### å…¶ä»–å·¥å…·

- **pyyaml>=6.0** - YAML é…ç½®æ–‡ä»¶è§£æ
- **tqdm>=4.65.0** - è¿›åº¦æ¡
- **tensorboard>=2.13.0** - è®­ç»ƒå¯è§†åŒ–
- **einops>=0.6.1** - å¼ é‡æ“ä½œ
- **safetensors>=0.3.1** - å®‰å…¨å¼ é‡æ ¼å¼
- **matplotlib>=3.7.0** - å¯è§†åŒ–

## ğŸŒ ç½‘ç»œé…ç½®

### Hugging Face ä¸‹è½½é…ç½®

å¦‚æœä» Hugging Face ä¸‹è½½æ¨¡å‹è¾ƒæ…¢ï¼Œå¯ä»¥é…ç½®é•œåƒæˆ–ä»£ç†ï¼š

#### æ–¹æ³• 1: ä½¿ç”¨é•œåƒï¼ˆæ¨èï¼‰

```bash
# è®¾ç½®é•œåƒ
export HF_ENDPOINT=https://hf-mirror.com
export HF_HUB_DOWNLOAD_TIMEOUT=600

# æ°¸ä¹…è®¾ç½®ï¼ˆæ·»åŠ åˆ° ~/.bashrcï¼‰
echo 'export HF_ENDPOINT=https://hf-mirror.com' >> ~/.bashrc
echo 'export HF_HUB_DOWNLOAD_TIMEOUT=600' >> ~/.bashrc
source ~/.bashrc
```

#### æ–¹æ³• 2: ä½¿ç”¨ä»£ç†

```bash
# è®¾ç½®ä»£ç†ï¼ˆæ ¹æ®ä½ çš„å®é™…ä»£ç†åœ°å€ä¿®æ”¹ï¼‰
export HTTP_PROXY=http://127.0.0.1:7890
export HTTPS_PROXY=http://127.0.0.1:7890

# æ°¸ä¹…è®¾ç½®
echo 'export HTTP_PROXY=http://127.0.0.1:7890' >> ~/.bashrc
echo 'export HTTPS_PROXY=http://127.0.0.1:7890' >> ~/.bashrc
source ~/.bashrc
```

#### æ–¹æ³• 3: ä½¿ç”¨è„šæœ¬

```bash
# ä½¿ç”¨æä¾›çš„è„šæœ¬
source setup_hf_mirror.sh  # é•œåƒ
# æˆ–
source setup_proxy.sh      # ä»£ç†
```

## ğŸ” ç¯å¢ƒæ£€æŸ¥

### æ£€æŸ¥ CUDA

```bash
python -c "import torch; print(f'CUDA å¯ç”¨: {torch.cuda.is_available()}'); print(f'CUDA ç‰ˆæœ¬: {torch.version.cuda}'); print(f'GPU æ•°é‡: {torch.cuda.device_count()}')"
```

### æ£€æŸ¥ GPU

```bash
nvidia-smi
```

åº”è¯¥çœ‹åˆ° GPU ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- GPU åç§°
- æ˜¾å­˜å¤§å°
- CUDA ç‰ˆæœ¬

### æ£€æŸ¥ä¾èµ–

```bash
python -c "import torch, diffusers, transformers, accelerate; print('æ‰€æœ‰ä¾èµ–å·²å®‰è£…')"
```

## âš™ï¸ é…ç½®ä¸´æ—¶ç›®å½•

å¦‚æœç³»ç»Ÿä¸´æ—¶ç›®å½•ä¸å¯ç”¨ï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨ä½¿ç”¨ `./outputs/tmp`ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼š

```bash
export TMPDIR=./outputs/tmp
export TMP=./outputs/tmp
export TEMP=./outputs/tmp
```

## ğŸ› å¸¸è§å®‰è£…é—®é¢˜

### é—®é¢˜ 1: CUDA ä¸å¯ç”¨

**ç—‡çŠ¶**: `torch.cuda.is_available()` è¿”å› `False`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ CUDA æ˜¯å¦æ­£ç¡®å®‰è£…ï¼š`nvidia-smi`
2. æ£€æŸ¥ PyTorch ç‰ˆæœ¬æ˜¯å¦åŒ¹é… CUDA ç‰ˆæœ¬
3. é‡æ–°å®‰è£…åŒ¹é…çš„ PyTorch ç‰ˆæœ¬

### é—®é¢˜ 2: ä¾èµ–å†²çª

**ç—‡çŠ¶**: å®‰è£…ä¾èµ–æ—¶å‡ºç°ç‰ˆæœ¬å†²çª

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä½¿ç”¨æ–°çš„è™šæ‹Ÿç¯å¢ƒ
conda create -n dit_new python=3.10
conda activate dit_new
pip install -r requirements.txt
```

### é—®é¢˜ 3: ä¸‹è½½è¶…æ—¶

**ç—‡çŠ¶**: ä» Hugging Face ä¸‹è½½æ¨¡å‹è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨é•œåƒï¼š`export HF_ENDPOINT=https://hf-mirror.com`
- ä½¿ç”¨ä»£ç†ï¼š`export HTTP_PROXY=http://127.0.0.1:7890`
- å¢åŠ è¶…æ—¶ï¼š`export HF_HUB_DOWNLOAD_TIMEOUT=600`

## ğŸ“ ä¸‹ä¸€æ­¥

- ğŸ“– [01. å¿«é€Ÿå¼€å§‹](./01-å¿«é€Ÿå¼€å§‹.md) - è¿è¡Œç¬¬ä¸€ä¸ªç¤ºä¾‹
- ğŸ“– [03. æ•°æ®å‡†å¤‡](./03-æ•°æ®å‡†å¤‡.md) - å‡†å¤‡è®­ç»ƒæ•°æ®

---

**éªŒè¯å®Œæˆ**: è¿è¡Œ `python verify_setup.py` ç¡®è®¤ç¯å¢ƒé…ç½®æ­£ç¡®ï¼

